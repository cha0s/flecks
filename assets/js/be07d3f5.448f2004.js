"use strict";(self.webpackChunkflecks_docusaurus=self.webpackChunkflecks_docusaurus||[]).push([[1204],{1538:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>u,contentTitle:()=>o,default:()=>p,frontMatter:()=>i,metadata:()=>c,toc:()=>d});var r=l(5893),s=l(1151),a=l(3200),t=l(6569);const i={title:"Creating a fleck",description:"A fleck is a module but also so much more."},o=void 0,c={id:"creating-a-fleck",title:"Creating a fleck",description:"A fleck is a module but also so much more.",source:"@site/docs/creating-a-fleck.mdx",sourceDirName:".",slug:"/creating-a-fleck",permalink:"/flecks/docs/creating-a-fleck",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{title:"Creating a fleck",description:"A fleck is a module but also so much more."},sidebar:"flecksSidebar",previous:{title:"Configuration",permalink:"/flecks/docs/configuration"},next:{title:"Building your application",permalink:"/flecks/docs/building-your-application"}},u={},d=[{value:"Your first fleck",id:"your-first-fleck",level:2},{value:"Create the fleck",id:"create-the-fleck",level:3},{value:"Aliasing for the win",id:"aliasing-for-the-win",level:3},{value:"Your first hook implementation",id:"your-first-hook-implementation",level:3},{value:"flecks injection",id:"flecks-injection",level:3}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.a)(),...e.components},{Details:l}=n;return l||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["If you are following along from the previous getting started\n",(0,r.jsx)(n.a,{href:"./configuration",children:"configuration page"}),", you have an application with 3 flecks:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"@flecks/build"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"@flecks/core"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"@flecks/server"})}),"\n"]}),"\n",(0,r.jsxs)(l,{children:[(0,r.jsx)("summary",{children:'About that "3 flecks" thing...'}),(0,r.jsxs)(n.p,{children:["Actually, your server application has ",(0,r.jsx)(n.strong,{children:"5 flecks"})," at this point:"]}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"@flecks/build"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"@flecks/build/server"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"@flecks/core"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"@flecks/core/server"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"@flecks/server"})}),"\n"]}),(0,r.jsxs)(n.p,{children:["flecks will load the ",(0,r.jsx)(n.code,{children:"[...]/server"})," fleck under any fleck that is loaded on the server. This is\nalso the case when using ",(0,r.jsx)(n.code,{children:"@flecks/web"})," which will automatically load ",(0,r.jsx)(n.code,{children:"[...]/client"})," flecks\nwhich are only loaded in the browser."]})]}),"\n",(0,r.jsx)(n.h2,{id:"your-first-fleck",children:"Your first fleck"}),"\n",(0,r.jsxs)(n.p,{children:["Let's make your website greet the user with a good ol' ",(0,r.jsx)(n.strong,{children:"hello world"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"To do this, you'll be creating your own little fleck. flecks also provides a built-in utility to\ncreate a fleck."}),"\n",(0,r.jsxs)(n.admonition,{title:"Your application is a monorepo by default",type:"note",children:[(0,r.jsxs)(n.p,{children:["You may have noticed that your little starter application has a ",(0,r.jsx)(n.code,{children:"packages"})," directory. By default,\nflecks structures your application as a monorepo."]}),(0,r.jsx)(n.p,{children:"This isn't any hard requirement, it's only a suggestion."})]}),"\n",(0,r.jsx)(n.h3,{id:"create-the-fleck",children:"Create the fleck"}),"\n",(0,r.jsx)(a.Z,{type:"fleck",pkg:"say-hello",children:(0,r.jsx)(n.p,{children:"Let's create our little fleck:"})}),"\n",(0,r.jsxs)(n.p,{children:["After some output, you'll find your new fleck at ",(0,r.jsx)(n.code,{children:"packages/say-hello"}),". Let's inspect our\n",(0,r.jsx)(n.code,{children:"build/flecks.yml"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yml",metastring:'title="build/flecks.yml"',children:"'@flecks/build': {}\n'@flecks/core':\n  id: 'hello-world'\n'@flecks/server': {}\n// highlight-next-line\n'@hello-world/say-hello:./packages/say-hello': {}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"aliasing-for-the-win",children:"Aliasing for the win"}),"\n",(0,r.jsx)(n.p,{children:"Notice there's a colon separating the path for this one. This is because this is an aliased fleck.\nThe part before the colon is the alias and the part after is the path to the package."}),"\n",(0,r.jsxs)(n.p,{children:["By the way, your other application code can import using the alias (e.g.\n",(0,r.jsx)(n.code,{children:"require('@hello-world/say-hello');"}),")\n",(0,r.jsx)(n.a,{href:"https://webpack.js.org/configuration/resolve/#resolvealias",children:"as if it were a package"}),"."]}),"\n",(0,r.jsxs)(l,{children:[(0,r.jsxs)("summary",{children:["Wait, my modules don't have to be in ",(0,r.jsx)("code",{children:"node_modules"}),"?"]}),(0,r.jsx)(n.p,{children:'Nope! When you\'re developing applications, it can be real nice to\njust pull in local source "packages".'}),(0,r.jsx)(n.p,{children:"That being said, sharing your packages on npm is a cool thing to do, so be rad and share your\nawesome flecks with the rest of us!"})]}),"\n",(0,r.jsx)(n.h3,{id:"your-first-hook-implementation",children:"Your first hook implementation"}),"\n",(0,r.jsxs)(n.p,{children:["There is a source file at ",(0,r.jsx)(n.code,{children:"packages/say-hello/src/index.js"})," but for now it's empty. Let's fill it\nout a bit:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",metastring:'title="packages/say-hello/src/index.js"',children:"export const hooks = {\n  '@flecks/server.up': async () => {\n    process.stdout.write('  hello server\\n');\n  },\n};\n"})}),"\n",(0,r.jsx)(t.Z,{cmd:"start",children:(0,r.jsx)(n.p,{children:"Now, restart your application:"})}),"\n",(0,r.jsx)(n.p,{children:"You will be greeted by a line in the output:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-terminal",children:"  hello server\n"})}),"\n",(0,r.jsx)(n.h3,{id:"flecks-injection",children:"flecks injection"}),"\n",(0,r.jsxs)(n.p,{children:["Hook implementations may receive arguments. After any arguments, the ",(0,r.jsx)(n.code,{children:"flecks"})," instance is always\npassed."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"@flecks/server.up"})," doesn't pass any arguments, so the ",(0,r.jsx)(n.code,{children:"flecks"})," instance is the first argument.\nLet's see how to use the instance to read some configuration:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",metastring:'title="packages/say-hello/src/index.js"',children:"export const hooks = {\n  '@flecks/server.up': async (flecks) => {\n    const {id} = flecks.get('@flecks/core');\n    process.stdout.write(`  hello server: ID ${id}\\n`);\n  },\n};\n"})}),"\n",(0,r.jsx)(n.p,{children:"This time, you will see:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-terminal",children:"  hello server: ID hello-world\n"})}),"\n",(0,r.jsx)(n.admonition,{title:"Still with us?",type:"note",children:(0,r.jsxs)(n.p,{children:["...or whatever your application's ID is. We're assuming you're following along from\n",(0,r.jsx)(n.a,{href:"./configuration",children:"the configuration page"}),"."]})}),"\n",(0,r.jsx)(n.p,{children:"Next, we'll go over some of the nuts and bolts of how your application is built."})]})}function p(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},3200:(e,n,l)=>{l.d(n,{Z:()=>i});var r=l(9286),s=l(4866),a=l(5162),t=l(5893);function i(e){let{children:n,headless:l=!1,pkg:i,type:o}=e;return(0,t.jsxs)(s.Z,{className:l&&"headless",groupId:"package-manager",children:[(0,t.jsxs)(a.Z,{value:"npm",label:"npm",children:[n,(0,t.jsxs)(r.Z,{language:"bash",children:["npm init @flecks/",o," ",i]})]}),(0,t.jsxs)(a.Z,{value:"yarn",label:"Yarn",children:[n,(0,t.jsxs)(r.Z,{language:"bash",children:["yarn create @flecks/",o," ",i]})]}),(0,t.jsxs)(a.Z,{value:"pnpm",label:"pnpm",children:[n,(0,t.jsxs)(r.Z,{language:"bash",children:["pnpm create @flecks/",o," ",i]})]}),(0,t.jsxs)(a.Z,{value:"bun",label:"Bun",children:[n,(0,t.jsxs)(r.Z,{language:"bash",children:["bun create @flecks/",o," ",i]})]})]})}},6569:(e,n,l)=>{l.d(n,{Z:()=>i});var r=l(9286),s=l(4866),a=l(5162),t=l(5893);function i(e){let{children:n,cmd:l,headless:i=!1}=e;return(0,t.jsxs)(s.Z,{className:i&&"headless",groupId:"package-manager",children:[(0,t.jsxs)(a.Z,{value:"npm",label:"npm",children:[n,(0,t.jsxs)(r.Z,{language:"bash",children:["npm run ",l]})]}),(0,t.jsxs)(a.Z,{value:"yarn",label:"Yarn",children:[n,(0,t.jsxs)(r.Z,{language:"bash",children:["yarn run ",l]})]}),(0,t.jsxs)(a.Z,{value:"pnpm",label:"pnpm",children:[n,(0,t.jsxs)(r.Z,{language:"bash",children:["pnpm run ",l]})]}),(0,t.jsxs)(a.Z,{value:"bun",label:"Bun",children:[n,(0,t.jsxs)(r.Z,{language:"bash",children:["bun run ",l]})]})]})}},5162:(e,n,l)=>{l.d(n,{Z:()=>t});l(7294);var r=l(512);const s={tabItem:"tabItem_Ymn6"};var a=l(5893);function t(e){let{children:n,hidden:l,className:t}=e;return(0,a.jsx)("div",{role:"tabpanel",className:(0,r.Z)(s.tabItem,t),hidden:l,children:n})}},4866:(e,n,l)=>{l.d(n,{Z:()=>y});var r=l(7294),s=l(512),a=l(2466),t=l(6550),i=l(469),o=l(1980),c=l(7392),u=l(12);function d(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:n,children:l}=e;return(0,r.useMemo)((()=>{const e=n??function(e){return d(e).map((e=>{let{props:{value:n,label:l,attributes:r,default:s}}=e;return{value:n,label:l,attributes:r,default:s}}))}(l);return function(e){const n=(0,c.l)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,l])}function p(e){let{value:n,tabValues:l}=e;return l.some((e=>e.value===n))}function f(e){let{queryString:n=!1,groupId:l}=e;const s=(0,t.k6)(),a=function(e){let{queryString:n=!1,groupId:l}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!l)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return l??null}({queryString:n,groupId:l});return[(0,o._X)(a),(0,r.useCallback)((e=>{if(!a)return;const n=new URLSearchParams(s.location.search);n.set(a,e),s.replace({...s.location,search:n.toString()})}),[a,s])]}function m(e){const{defaultValue:n,queryString:l=!1,groupId:s}=e,a=h(e),[t,o]=(0,r.useState)((()=>function(e){let{defaultValue:n,tabValues:l}=e;if(0===l.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!p({value:n,tabValues:l}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${l.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const r=l.find((e=>e.default))??l[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:n,tabValues:a}))),[c,d]=f({queryString:l,groupId:s}),[m,g]=function(e){let{groupId:n}=e;const l=function(e){return e?`docusaurus.tab.${e}`:null}(n),[s,a]=(0,u.Nk)(l);return[s,(0,r.useCallback)((e=>{l&&a.set(e)}),[l,a])]}({groupId:s}),x=(()=>{const e=c??m;return p({value:e,tabValues:a})?e:null})();(0,i.Z)((()=>{x&&o(x)}),[x]);return{selectedValue:t,selectValue:(0,r.useCallback)((e=>{if(!p({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);o(e),d(e),g(e)}),[d,g,a]),tabValues:a}}var g=l(2389);const x={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var j=l(5893);function b(e){let{className:n,block:l,selectedValue:r,selectValue:t,tabValues:i}=e;const o=[],{blockElementScrollPositionUntilNextRender:c}=(0,a.o5)(),u=e=>{const n=e.currentTarget,l=o.indexOf(n),s=i[l].value;s!==r&&(c(n),t(s))},d=e=>{let n=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{const l=o.indexOf(e.currentTarget)+1;n=o[l]??o[0];break}case"ArrowLeft":{const l=o.indexOf(e.currentTarget)-1;n=o[l]??o[o.length-1];break}}n?.focus()};return(0,j.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.Z)("tabs",{"tabs--block":l},n),children:i.map((e=>{let{value:n,label:l,attributes:a}=e;return(0,j.jsx)("li",{role:"tab",tabIndex:r===n?0:-1,"aria-selected":r===n,ref:e=>o.push(e),onKeyDown:d,onClick:u,...a,className:(0,s.Z)("tabs__item",x.tabItem,a?.className,{"tabs__item--active":r===n}),children:l??n},n)}))})}function k(e){let{lazy:n,children:l,selectedValue:s}=e;const a=(Array.isArray(l)?l:[l]).filter(Boolean);if(n){const e=a.find((e=>e.props.value===s));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return(0,j.jsx)("div",{className:"margin-top--md",children:a.map(((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==s})))})}function v(e){const n=m(e);return(0,j.jsxs)("div",{className:(0,s.Z)("tabs-container",x.tabList),children:[(0,j.jsx)(b,{...e,...n}),(0,j.jsx)(k,{...e,...n})]})}function y(e){const n=(0,g.Z)();return(0,j.jsx)(v,{...e,children:d(e.children)},String(n))}}}]);